<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico Dashboard</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        .log {
            margin: 10px 0;
            padding: 10px;
            background: #2a2a2a;
            border-left: 3px solid #00ff00;
        }
        .error {
            border-left-color: #ff0000;
            color: #ff6b6b;
        }
        .success {
            border-left-color: #00ff00;
        }
        .warning {
            border-left-color: #ffaa00;
            color: #ffaa00;
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico do Dashboard</h1>
    <div id="logs"></div>

    <script>
        const logsDiv = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(div);
        }

        async function testDashboard() {
            addLog('üöÄ Iniciando diagn√≥stico...', 'info');
            
            // Check token
            const token = localStorage.getItem('token');
            if (!token) {
                addLog('‚ùå ERRO: Token n√£o encontrado no localStorage', 'error');
                return;
            }
            addLog('‚úÖ Token encontrado: ' + token.substring(0, 20) + '...', 'success');

            // Test APIs
            const baseURL = 'http://localhost:3000/api';
            
            try {
                addLog('üîµ Testando GET /finance/summary...', 'info');
                const financeRes = await fetch(`${baseURL}/finance/summary`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                addLog(`Finance API: ${financeRes.status} ${financeRes.statusText}`, 
                    financeRes.ok ? 'success' : 'error');
                if (!financeRes.ok) {
                    const error = await financeRes.text();
                    addLog(`Erro: ${error}`, 'error');
                }
            } catch (err) {
                addLog(`‚ùå Finance API falhou: ${err.message}`, 'error');
            }

            try {
                addLog('üîµ Testando GET /appointments (today)...', 'info');
                const today = new Date().toISOString().split('T')[0];
                const apptRes = await fetch(`${baseURL}/appointments?date=${today}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                addLog(`Appointments API: ${apptRes.status} ${apptRes.statusText}`, 
                    apptRes.ok ? 'success' : 'error');
                if (!apptRes.ok) {
                    const error = await apptRes.text();
                    addLog(`Erro: ${error}`, 'error');
                }
            } catch (err) {
                addLog(`‚ùå Appointments API falhou: ${err.message}`, 'error');
            }

            try {
                addLog('üîµ Testando GET /appointments (pending)...', 'info');
                const pendingRes = await fetch(`${baseURL}/appointments?status=awaiting_validation`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                addLog(`Pending Payments API: ${pendingRes.status} ${pendingRes.statusText}`, 
                    pendingRes.ok ? 'success' : 'error');
                if (!pendingRes.ok) {
                    const error = await pendingRes.text();
                    addLog(`Erro: ${error}`, 'error');
                }
            } catch (err) {
                addLog(`‚ùå Pending Payments API falhou: ${err.message}`, 'error');
            }

            addLog('üèÅ Diagn√≥stico completo!', 'success');
        }

        testDashboard();
    </script>
</body>
</html>
